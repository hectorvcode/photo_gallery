<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title> Carrito de Compras </ion-title>
    <ion-buttons slot="end">
      <ion-button
        fill="clear"
        (click)="clearCart()"
        [disabled]="cartItems.length === 0"
        color="danger"
      >
        <ion-icon name="trash"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Mi Carrito</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Cart Items -->
  <div class="cart-container" *ngIf="cartItems.length > 0">
    <ion-list lines="none">
      <ion-item-sliding *ngFor="let item of cartItems; trackBy: trackByItemId">
        <ion-item class="cart-item">
          <div class="item-content">
            <div class="product-image-container">
              <img
                [src]="item.product.image"
                [alt]="item.product.title"
                class="product-image"
              />
            </div>

            <div class="product-details">
              <h3 class="product-title">{{ item.product.title }}</h3>
              <p class="product-category">{{ item.product.category }}</p>
              <div class="price-info">
                <span class="unit-price">${{ item.product.price }}</span>
                <span class="subtotal"
                  >${{ getItemSubtotal(item).toFixed(2) }}</span
                >
              </div>
            </div>
          </div>

          <div class="quantity-controls" slot="end">
            <ion-button
              fill="clear"
              size="small"
              (click)="updateQuantity(item, item.quantity - 1)"
              [disabled]="item.quantity <= 1"
            >
              <ion-icon name="remove"></ion-icon>
            </ion-button>

            <span class="quantity">{{ item.quantity }}</span>

            <ion-button
              fill="clear"
              size="small"
              (click)="updateQuantity(item, item.quantity + 1)"
            >
              <ion-icon name="add"></ion-icon>
            </ion-button>

            <ion-button
              fill="clear"
              size="small"
              color="danger"
              (click)="confirmRemoveItem(item)"
            >
              <ion-icon name="trash"></ion-icon>
            </ion-button>
          </div>
        </ion-item>

        <ion-item-options side="end">
          <ion-item-option color="danger" (click)="confirmRemoveItem(item)">
            <ion-icon name="trash" slot="icon-only"></ion-icon>
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
    </ion-list>

    <!-- Cart Summary -->
    <div class="cart-summary">
      <ion-card>
        <ion-card-content>
          <div class="summary-row">
            <span
              >Subtotal ({{ cartItems.length }} {{ cartItems.length === 1 ?
              'producto' : 'productos' }}):</span
            >
            <span class="amount">${{ cartTotal.toFixed(2) }}</span>
          </div>
          <div class="summary-row">
            <span>Envío:</span>
            <span class="amount">Gratis</span>
          </div>
          <hr />
          <div class="summary-row total">
            <span><strong>Total:</strong></span>
            <span class="amount"
              ><strong>${{ cartTotal.toFixed(2) }}</strong></span
            >
          </div>
        </ion-card-content>
      </ion-card>

      <ion-button
        expand="block"
        size="large"
        (click)="checkout()"
        class="checkout-btn"
      >
        <ion-icon name="card" slot="start"></ion-icon>
        Proceder al Pago
      </ion-button>
    </div>
  </div>

  <!-- Empty Cart State -->
  <div class="empty-cart" *ngIf="cartItems.length === 0">
    <div class="empty-cart-content">
      <ion-icon name="cart-outline" size="large" color="medium"></ion-icon>
      <h2>Tu carrito está vacío</h2>
      <p>Agrega productos desde el catálogo para comenzar tu compra.</p>
      <ion-button
        routerLink="/tabs/tab2"
        fill="outline"
        class="view-products-btn"
      >
        <ion-icon name="storefront" slot="start"></ion-icon>
        Ver Productos
      </ion-button>
    </div>
  </div>
</ion-content>
